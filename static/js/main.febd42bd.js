(()=>{"use strict";var e={5918:(e,n,t)=>{t.r(n),t.d(n,{default:()=>E});var l,i,r=t(296),o=t(6665),u=t(4701),a=t(4262),s=t(4890),c=t(6283),d=t(467),f=t(5679),h=t(397),v=(null==(l=f.default.expoConfig)||null==(i=l.extra)||i.apiBaseUrl,(0,o.createContext)());function p(e){var n=e.children,t=(0,o.useState)(null),l=(0,r.default)(t,2),i=l[0],u=l[1],a=(0,o.useState)(!0),s=(0,r.default)(a,2),c=s[0],d=s[1];return(0,o.useEffect)((function(){fetch("https://pool-hall-waitlist-3b8c64cbf25d.herokuapp.com/api/auth/google",{credentials:"include"}).then((function(e){if(200===e.status)return e.json();throw new Error("Not authenticated")})).then((function(e){e.success?u(e.user):u(null)})).catch((function(){return u(null)})).finally((function(){return d(!1)}))}),[]),(0,h.jsx)(v.Provider,{value:{user:i,setUser:u,loading:c},children:n})}var m,x,b,g=t(2038),j=(null==(m=f.default.expoConfig)||null==(x=m.extra)?void 0:x.apiBaseUrl)||"http://localhost:3000";function y(){return b||(b=(0,g.io)(j,{autoConnect:!0})),b}function _(e,n){b||y(),b.emit(e,n)}var C=function(e,n,t,l,i){b.emit("confirm_win",{tableId:e,winnerId:n,loserId:t,confirmed:l},i)};const I=y();function k(e){var n,t,l=e.table,i=(0,o.useContext)(v).user,r=function(){var e,n;null!=i&&i._id&&null!=l&&l._id&&(e=l._id,n=i._id,console.log("[claimWin] Emitting claim_win",{tableId:e,winnerId:n}),_("claim_win",{tableId:e,winnerId:n}))},u=function(e){null!=l&&l._id&&e&&_("admin:remove_player",{tableId:l._id,userId:e})},a=null!=(n=null==l?void 0:l.players)?n:[];return(0,o.useEffect)((function(){null!=i&&i._id&&I.emit("register_user",{userId:i._id})}),[i]),(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{style:{border:"1px solid #ccc",padding:10,marginBottom:10,borderRadius:5},children:[(0,h.jsxs)("h4",{children:["Table ",null!=(t=null==l?void 0:l.tableNumber)?t:"Unknown"]}),(0,h.jsx)("strong",{children:"Players:"}),(0,h.jsx)("ul",{children:a.map((function(e,n){var t,l=null==e?void 0:e.user,o=null!=(t=null==l?void 0:l._id)?t:n,a=(null==l?void 0:l.displayName)||(null==l?void 0:l.username)||"Unknown Player";return(0,h.jsxs)("li",{style:{marginBottom:6},children:[a,(null==i?void 0:i.isAdmin)&&(null==l?void 0:l._id)&&(0,h.jsx)("button",{onClick:function(){return u(l._id)},style:{marginLeft:10},children:"Remove Player"}),(null==i?void 0:i._id)===(null==l?void 0:l._id)&&(0,h.jsx)("button",{onClick:r,style:{marginLeft:10},children:"I WON"})]},o)}))}),a.length<2&&(0,h.jsx)("button",{onClick:function(){null!=i&&i._id&&null!=l&&l._id&&I.emit("join_table",{tableId:l._id,userId:i._id})},children:"Join Table"})]})})}function w(){var e=(0,o.useContext)(v),n=e.user,t=e.setUser,l=e.loading,i=(0,o.useState)([]),u=(0,r.default)(i,2),a=u[0],s=u[1],c=(0,o.useState)([]),f=(0,r.default)(c,2),p=f[0],m=f[1],x=(0,o.useState)(!1),b=(0,r.default)(x,2),g=b[0],j=b[1],y=(0,o.useState)(null),w=(0,r.default)(y,2),S=w[0],O=w[1],T=(0,o.useState)(30),P=(0,r.default)(T,2),U=P[0],q=P[1],L=(0,o.useRef)(null),B=(0,o.useState)(null),R=(0,r.default)(B,2),A=R[0],E=R[1],W=(0,o.useState)(!1),N=(0,r.default)(W,2),z=N[0],Q=N[1];(0,o.useEffect)((function(){function e(e){var n=e.queue,t=e.tables;console.log("Received state_update with queue:",n,"tables:",t),s(n),m(t)}function n(e){O(e),j(!0),q(30),L.current&&clearInterval(L.current),L.current=setInterval((function(){q((function(e){return e<=1?(clearInterval(L.current),M(),0):e-1}))}),1e3)}function t(e){console.log("Received win confirmation request:",e),E(e)}return I.on("state_update",e),I.on("table_invite",(function(e){n(e.tableId)})),I.on("win_confirmation_request",t),function(){I.off("state_update",e),I.off("invite:joinTable",n),I.off("win_confirmation_request",t),L.current&&clearInterval(L.current)}}),[]);var M=function(){I.emit("invite:skip",{userId:n._id}),clearInterval(L.current),j(!1),O(null)},F=function(){var e=(0,d.default)((function*(){try{(yield fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok&&t(null)}catch(e){console.error("Logout failed:",e)}}));return function(){return e.apply(this,arguments)}}();return l?(0,h.jsx)("div",{children:"Loading..."}):n?(0,h.jsxs)("div",{style:{maxWidth:900,margin:"0 auto",padding:20},children:[(0,h.jsxs)("h2",{children:["Welcome, ",n.displayName||n.username]}),(0,h.jsx)("button",{onClick:F,style:{marginBottom:20},children:"Logout"}),(0,h.jsxs)("div",{style:{marginBottom:20},children:[(0,h.jsx)("button",{onClick:function(){var e;null!=n&&n._id&&(e=n._id,console.log("joinQueue called with userId:",e),_("join_queue",e))},children:"Join Queue"})," ",n.isAdmin&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{onClick:function(){_("admin:clear_queue")},style:{marginLeft:10},children:"Clear Queue"}),(0,h.jsx)("button",{onClick:function(){_("admin:clear_tables")},style:{marginLeft:10},children:"Clear All Tables"})]})]}),(0,h.jsx)("h3",{children:"Queue:"}),0===a.length?(0,h.jsx)("p",{children:"The queue is currently empty."}):(0,h.jsx)("ol",{children:a.map((function(e,n){var t,l;return(0,h.jsx)("li",{children:(null==(l=e.user)?void 0:l.username)||"Unnamed User"},(null==(t=e.user)?void 0:t._id)||e.userId||n)}))}),(0,h.jsx)("h3",{children:"Tables:"}),(0,h.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:16,marginTop:12},children:p.map((function(e,n){var t,l;return(0,h.jsx)(k,{table:e},null!=(t=null!=(l=e._id)?l:e.tableNumber)?t:n)}))}),A&&(0,h.jsxs)("div",{style:{position:"fixed",top:100,left:"50%",transform:"translateX(-50%)",background:"white",border:"1px solid #ccc",padding:20,zIndex:1e3},children:[(0,h.jsx)("h4",{children:"Your opponent claims they won. Confirm?"}),(0,h.jsx)("button",{onClick:function(){A&&!z&&(Q(!0),C(A.tableId,A.winnerId,A.loserId,!0,(function(e){console.log("Confirm win callback:",e),Q(!1),null!=e&&e.success&&E(null)})))},disabled:z,style:{marginRight:10},children:z?"Confirming...":"Confirm"}),(0,h.jsx)("button",{onClick:function(){E(null)},children:"Reject"})]}),g&&(0,h.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:(0,h.jsxs)("div",{style:{backgroundColor:"white",padding:20,borderRadius:10,textAlign:"center",minWidth:300},children:[(0,h.jsxs)("p",{children:["You have been invited to join table ",S]}),(0,h.jsxs)("p",{children:["Time remaining: ",U," seconds"]}),(0,h.jsx)("button",{onClick:function(){S&&(I.emit("accept_invite",{tableId:S,userId:n._id}),clearInterval(L.current),j(!1),O(null))},children:"Accept Invite"})," ",(0,h.jsx)("button",{onClick:M,children:"Skip"})]})})]}):(0,h.jsx)("div",{children:"Please log in to see your dashboard"})}var S,O,T,P,U=t(3929),q=t(8514),L=t(9632);null==(S=f.default.expoConfig)||null==(O=S.extra)||O.apiBaseUrl;function B(){return(0,h.jsx)(U.default,{children:(0,h.jsx)(q.default,{title:"Login with Google",onPress:function(){L.default.openURL("https://pool-hall-waitlist-3b8c64cbf25d.herokuapp.com/api/auth/google")}})})}var R=(null==(T=f.default.expoConfig)||null==(P=T.extra)?void 0:P.apiBaseUrl)||"http://localhost:3000";function A(){var e=(0,o.useContext)(v),n=e.user,t=e.setUser,l=(0,o.useState)([]),i=(0,r.default)(l,2),s=i[0],d=i[1],f=(0,o.useState)([]),p=(0,r.default)(f,2),m=p[0],x=p[1],b=(0,o.useState)(null),j=(0,r.default)(b,2),y=j[0],_=j[1],C=(0,o.useState)(!0),I=(0,r.default)(C,2),k=I[0],S=I[1];return(0,o.useEffect)((function(){fetch(`${R}/api/auth/success`,{credentials:"include"}).then((function(e){return e.json()})).then((function(e){e.success?t(e.user):t(null)})).catch((function(e){console.error("Auth check failed:",e),t(null)})).finally((function(){return S(!1)}))}),[t]),(0,o.useEffect)((function(){if(n){var e=(0,g.default)(R,{withCredentials:!0});return _(e),e.on("state_update",(function(e){var n=e.queue,t=e.tables;d(n),x(t)})),e.on("connect_error",(function(e){console.error("Socket connection error:",e)})),function(){e.disconnect()}}}),[n]),k?(0,h.jsx)(c.default,{style:{textAlign:"center",marginTop:50},children:"Loading..."}):n?(0,h.jsx)(u.default,{style:W.container,children:(0,h.jsxs)(a.default,{children:[(0,h.jsx)(c.default,{style:W.title,children:"Pool Hall Waitlist"}),(0,h.jsx)(w,{queue:s,tables:m,socket:y})]})}):(0,h.jsx)(B,{})}function E(){return(0,h.jsx)(p,{children:(0,h.jsx)(A,{})})}var W=s.default.create({container:{flex:1,marginTop:50,paddingHorizontal:16},title:{fontSize:28,fontWeight:"bold",textAlign:"center",marginBottom:24}})}},n={};function t(l){var i=n[l];if(void 0!==i)return i.exports;var r=n[l]={exports:{}};return e[l](r,r.exports,t),r.exports}t.m=e,(()=>{var e=[];t.O=(n,l,i,r)=>{if(!l){var o=1/0;for(c=0;c<e.length;c++){for(var[l,i,r]=e[c],u=!0,a=0;a<l.length;a++)(!1&r||o>=r)&&Object.keys(t.O).every((e=>t.O[e](l[a])))?l.splice(a--,1):(u=!1,r<o&&(o=r));if(u){e.splice(c--,1);var s=i();void 0!==s&&(n=s)}}return n}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[l,i,r]}})(),t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var l in n)t.o(n,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:n[l]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};t.O.j=n=>0===e[n];var n=(n,l)=>{var i,r,[o,u,a]=l,s=0;if(o.some((n=>0!==e[n]))){for(i in u)t.o(u,i)&&(t.m[i]=u[i]);if(a)var c=a(t)}for(n&&n(l);s<o.length;s++)r=o[s],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(c)},l=self.webpackChunkweb=self.webpackChunkweb||[];l.forEach(n.bind(null,0)),l.push=n.bind(null,l.push.bind(l))})();var l=t.O(void 0,[619],(()=>t(5036)));l=t.O(l)})();
//# sourceMappingURL=main.febd42bd.js.map